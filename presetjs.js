     const usasamplingtable = [ 
{id: "usa_50_2" ,sample : [ {sample : 26 , times:1 , A: 1, B: 2, C: 7, D: 1, E: 2, F: 6 } , {sample : 24 , times:1 , A: 2, B: 2, C: 6, D: 0, E: 0, F: 0} ] },
{id: "usa_50_3" ,sample : [ {sample : 16 , times:2 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0 } , {sample : 18 , times:1 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 5} ] },
{id: "usa_50_4" ,sample : [ {sample : 12 , times:3 , A: 2, B: 2, C: 3, D: 0, E: 0, F: 0 } , {sample : 14 , times:1 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 3} ] },
{id: "usa_50_5" ,sample : [ {sample : 10 , times:5 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
    {id: "usa_80_2" ,sample : [ {sample : 40 , times:2 , A: 2, B: 2, C: 10, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_80_3" ,sample : [ {sample : 30 , times:2 , A: 1, B: 2, C: 8, D: 1, E: 2, F: 7 } , {sample : 20 , times:1 , A: 1, B: 2, C: 10, D: 0, E: 0, F: 0} ] },
{id: "usa_80_4" ,sample : [ {sample : 20 , times:4 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_80_5" ,sample : [ {sample : 16 , times:5 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_125_2" ,sample : [ {sample : 62 , times:1 , A: 1, B: 2, C: 21, D: 1, E: 2, F: 10 } , {sample : 63 , times:1 , A: 1, B: 3, C: 18, D: 1, E: 1, F: 9} ] },
{id: "usa_125_3" ,sample : [ {sample : 42 , times:2 , A: 1, B: 2, C: 10, D: 1, E: 2, F: 11 } , {sample : 41 , times:1 , A: 1, B: 3, C: 10, D: 1, E: 1, F: 11} ] },
{id: "usa_125_4" ,sample : [ {sample : 30 , times:3 , A: 1, B: 2, C: 8, D: 1, E: 2, F: 7 } , {sample : 35 , times:1 , A: 1, B: 3, C: 9, D: 1, E: 1, F: 8} ] },
{id: "usa_125_5" ,sample : [ {sample : 26 , times:4 , A: 1, B: 2, C: 7, D: 1, E: 2, F: 6 } , {sample : 21 , times:1 , A: 1, B: 3, C: 6, D: 1, E: 1, F: 3} ] },
{id: "usa_125_6" ,sample : [ {sample : 20 , times:5 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0 } , {sample : 25 , times:1 , A: 1, B: 3, C: 6, D: 1, E: 1, F: 7} ] },
{id: "usa_125_7" ,sample : [ {sample : 18 , times:6 , A: 1, B: 2, C: 5, D: 1, E: 2, F: 4 } , {sample : 17 , times:1 , A: 1, B: 3, C: 5, D: 1, E: 1, F: 2} ] },
{id: "usa_125_8" ,sample : [ {sample : 16 , times:7 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0 } , {sample : 13 , times:1 , A: 1, B: 3, C: 3, D: 1, E: 1, F: 4} ] },
{id: "usa_125_9" ,sample : [ {sample : 14 , times:8 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 3 } , {sample : 13 , times:1 , A: 1, B: 3, C: 3, D: 1, E: 1, F: 4} ] },
{id: "usa_125_10" ,sample : [ {sample : 12 , times:9 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 3 } , {sample : 17 , times:1 , A: 1, B: 3, C: 4, D: 1, E: 1, F: 5} ] },
{id: "usa_200_2" ,sample : [ {sample : 100 , times:2 , A: 2, B: 2, C: 25, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_200_3" ,sample : [ {sample : 68 , times:2 , A: 2, B: 2, C: 17, D: 0, E: 0, F: 0 } , {sample : 64 , times:1 , A: 2, B: 2, C: 16, D: 0, E: 0, F: 0} ] },
{id: "usa_200_4" ,sample : [ {sample : 50 , times:4 , A: 1, B: 2, C: 12, D: 1, E: 2, F: 13 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_200_5" ,sample : [ {sample : 40 , times:5 , A: 2, B: 2, C: 10, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_200_6" ,sample : [ {sample : 34 , times:5 , A: 1, B: 2, C: 9, D: 1, E: 2, F: 8 } , {sample : 30 , times:1 , A: 1, B: 2, C: 8, D: 1, E: 2, F: 7} ] },
{id: "usa_200_7" ,sample : [ {sample : 30 , times:6 , A: 1, B: 2, C: 7, D: 1, E: 2, F: 8 } , {sample : 20 , times:1 , A: 1, B: 2, C: 6, D: 1, E: 2, F: 4} ] },
{id: "usa_200_8" ,sample : [ {sample : 26 , times:6 , A: 1, B: 2, C: 7, D: 1, E: 2, F: 6 } , {sample : 22 , times:2 , A: 1, B: 2, C: 6, D: 1, E: 2, F: 5} ] },
{id: "usa_200_9" ,sample : [ {sample : 24 , times:5 , A: 2, B: 2, C: 6, D: 0, E: 0, F: 0 } , {sample : 20 , times:4 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0} ] },
{id: "usa_200_10" ,sample : [ {sample : 20 , times:10 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_200_11" ,sample : [ {sample : 20 , times:6 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0 } , {sample : 16 , times:5 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0} ] },
{id: "usa_200_12" ,sample : [ {sample : 16 , times:8 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0 } , {sample : 18 , times:4 , A: 1, B: 2, C: 5, D: 1, E: 2, F: 4} ] },
{id: "usa_200_13" ,sample : [ {sample : 16 , times:9 , A: 2, B: 2, C: 4, D: 0, E: 0, F: 0 } , {sample : 14 , times:4 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 3} ] },
{id: "usa_200_14" ,sample : [ {sample : 16 , times:10 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 5 } , {sample : 10 , times:4 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2} ] },
{id: "usa_200_15" ,sample : [ {sample : 14 , times:10 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 3 } , {sample : 12 , times:5 , A: 2, B: 2, C: 3, D: 0, E: 0, F: 0} ] },
{id: "usa_200_16" ,sample : [ {sample : 14 , times:10 , A: 1, B: 2, C: 4, D: 1, E: 2, F: 3 } , {sample : 10 , times:6 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2} ] },
{id: "usa_200_17" ,sample : [ {sample : 12 , times:13 , A: 2, B: 2, C: 3, D: 0, E: 0, F: 0 } , {sample : 11 , times:4 , A: 1, B: 3, C: 3, D: 1, E: 1, F: 2} ] },
{id: "usa_200_18" ,sample : [ {sample : 20 , times:2 , A: 2, B: 2, C: 5, D: 0, E: 0, F: 0 } , {sample : 10 , times:16 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2} ] },
{id: "usa_200_19" ,sample : [ {sample : 10 , times:14 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 12 , times:5 , A: 1, B: 3, C: 3, D: 1, E: 1, F: 3} ] },
{id: "usa_200_20" ,sample : [ {sample : 10 , times:20 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 0 , times:0 , A: 0, B: 0, C: 0, D: 0, E: 0, F: 0} ] },
{id: "usa_200_21" ,sample : [ {sample : 10 , times:11 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 9 , times:10 , A: 1, B: 3, C: 2, D: 1, E: 1, F: 3} ] },
{id: "usa_200_22" ,sample : [ {sample : 10 , times:12 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 8 , times:10 , A: 2, B: 2, C: 2, D: 0, E: 0, F: 0} ] },
{id: "usa_200_23" ,sample : [ {sample : 10 , times:13 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 7 , times:10 , A: 1, B: 3, C: 2, D: 1, E: 1, F: 1} ] },
{id: "usa_200_24" ,sample : [ {sample : 10 , times:14 , A: 1, B: 2, C: 3, D: 1, E: 2, F: 2 } , {sample : 6 , times:10 , A: 1, B: 2, C: 2, D: 1, E: 2, F: 1} ] },
{id: "usa_200_25" ,sample : [ {sample : 8 , times:15 , A: 1, B: 2, C: 2, D: 1, E: 2, F: 2 } , {sample : 8 , times:10 , A: 2, B: 2, C: 2, D: 0, E: 0, F: 0} ] },

    ]


   

  
  function clearItemTable() {
                const tbody = document.querySelector("#item_table tbody");
                if (tbody) tbody.innerHTML = "";
            }



  const inputs = document.querySelectorAll('#section-a input');
 const planSelect = document.getElementById('InspectionPlanKey');

  // AQL dropdowns
  const AQL_holes = document.getElementById('AQL_holes');
  const AQL_NFG = document.getElementById('AQL_NFG');
  const AQL_NAG = document.getElementById('AQL_NAG');
  const AQL_Major = document.getElementById('AQL_Major');
  const AQL_Minor = document.getElementById('AQL_Minor');

  inputs.forEach(inp => inp.addEventListener('input', calculate));
  planSelect.addEventListener('change',changemaxpcs);

function changemaxpcs() {
 const maxpcs = document.getElementById('maxPiecesLot')
  let maxSize = (planSelect.value === 'USA')
        ? 500000
        : 1000000
    maxpcs.value = maxSize ;
     const single = document.getElementById('sampleInnerCarton')
       let singlesize = (planSelect.value === 'USA')
        ? 2
        : 1
    single.value = singlesize
     
calculate()

}


  function calculate() {
    const totalPieces = parseInt(document.getElementById('totalPieces').value) || 0;
    const piecesPerCarton = parseInt(document.getElementById('piecesPerCarton').value) || 0;
    const cartonPerPallet = parseInt(document.getElementById('cartonPerPallet').value) || 0;
    const maxPiecesLot = parseInt(document.getElementById('maxPiecesLot').value) || 1000000;
    const planType = planSelect.value;

    // Set AQL dropdowns depending on USA vs Non-USA
    if (planType === 'USA') {
      setAQLValues({
       holes: "1.50",
        NFG: "0.25",
        NAG: "N/A",
        Major: "2.50",
        Minor: "4.00"
      }, false); // make readonly
    } else {
      setAQLValues({
       holes: "1.50",
        NFG: "0.25",
        NAG: "N/A",
        Major: "2.50",
        Minor: "4.00"
      }, false); // editable
    }

    const lotsTableBody = document.querySelector('#lotsTable tbody');
    lotsTableBody.innerHTML = '';
    if (totalPieces <= 0 || piecesPerCarton <= 0 || cartonPerPallet <= 0) return;

    const palletCapacityPieces = piecesPerCarton * cartonPerPallet;
    let remainingPieces = totalPieces;
    let lotNumber = 1;
    let totalLots = 0, totalCartons = 0;

    while (remainingPieces > 0) {
      let maxPalletsPerLot = Math.floor(maxPiecesLot / palletCapacityPieces);
      if (maxPalletsPerLot < 1) maxPalletsPerLot = 1;

      let palletsThisLot = Math.min(maxPalletsPerLot, Math.ceil(remainingPieces / palletCapacityPieces));
      let pcsThisLot = Math.min(palletsThisLot * palletCapacityPieces, remainingPieces);
      let cartonsThisLot = pcsThisLot / piecesPerCarton;

      let sampleSize = (planType === 'USA')
        ? getSampleSizeUSA(pcsThisLot)
        : getSampleSize(pcsThisLot);

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${lotNumber}</td>
        <td>${palletsThisLot}</td>
        <td>${pcsThisLot}</td>
        <td>${cartonsThisLot}</td>
        <td>${sampleSize}</td>
      `;
      lotsTableBody.appendChild(row);

      remainingPieces -= pcsThisLot;
      lotNumber++;
      totalLots++;
      totalCartons += cartonsThisLot;
    }

    document.getElementById('summary').innerHTML = `
      <p><strong>Total Lots:</strong> ${totalLots}
        <br><strong>Total Cartons:</strong> ${totalCartons}
        <br><strong>Calculation:</strong> ${planType === 'USA' ? 'USA' : 'Non USA'}</p>
    `;
    clearItemTable()
  }

  function setAQLValues(values, readonly) {
    AQL_holes.value = values.holes;
    AQL_NFG.value = values.NFG;
    AQL_NAG.value = values.NAG;
    AQL_Major.value = values.Major;
    AQL_Minor.value = values.Minor;

    [ AQL_NFG, AQL_NAG, AQL_Major, AQL_Minor].forEach(sel => {
      sel.disabled = readonly; // AQL_holes, view-only if USA
    });
  }

  function getSampleSize(ssVal) {
    if (ssVal > 500000) return 500;
    else if (ssVal > 150000) return 315;
    else if (ssVal > 35000) return 200;
    else if (ssVal > 10000) return 125;
    else if (ssVal > 3200) return 80;
    else if (ssVal > 1200) return 50;
    else if (ssVal > 500) return 32;
    else return 0;
  }

  function getSampleSizeUSA(ssVal) {
    if (ssVal > 500000) return 200;
    else if (ssVal > 150000) return 200;
    else if (ssVal > 35000) return 125;
    else if (ssVal > 10000) return 80;
    else if (ssVal > 3200) return 50;
    else return 0;
  }


  
          

const acceptarray = [
    { code: "K", Key: "125","0.10": 0, "0.15": 0, "0.25": 1, "0.40": 1, "0.65": 2, "1.00": 3, "1.50": 5, "2.50": 7, "4.00": 10, "6.50": 14 },
    { code: "L", Key: "200","0.10": 0, "0.15": 0, "0.25": 1, "0.40": 2, "0.65": 3, "1.00": 5, "1.50": 7, "2.50": 10, "4.00": 14, "6.50": 21 },
    { code: "M", Key: "315","0.10": 0, "0.15": 1, "0.25": 2, "0.40": 3, "0.65": 5, "1.00": 7, "1.50": 10, "2.50": 14, "4.00": 21, "6.50": 33 },
    { code: "N", Key: "500","0.10": 1, "0.15": 2, "0.25": 3, "0.40": 5, "0.65": 7, "1.00": 10, "1.50": 14, "2.50": 21, "4.00": 33, "6.50": 52 },
];

 
              const acceptarrayUSA = [
 { code: "L", Key: "50"  ,"0.10": 0, "0.15": 0, "0.25": 0, "0.40": 0, "0.65": 0, "1.00": 0, "1.50": 0,   "2.50": 3 , "4.00": 5 , "6.50": 7  },
 { code: "M", Key: "80"  ,"0.10": 0, "0.15": 0, "0.25": 0, "0.40": 0, "0.65": 0, "1.00": 0, "1.50": 0,   "2.50": 5 , "4.00": 7 , "6.50": 10 },
 { code: "N", Key: "125" ,"0.10": 0, "0.15": 0, "0.25": 0, "0.40": 0, "0.65": 0, "1.00": 0, "1.50": 1,   "2.50": 7 , "4.00": 10, "6.50": 14 },
 { code: "P", Key: "200" ,"0.10": 0, "0.15": 0, "0.25": 1, "0.40": 0, "0.65": 0, "1.00": 1, "1.50": 2,   "2.50": 10, "4.00": 14, "6.50": 21 }

            ];


            



function getCurrentLot() {
  const lotsTable = document.querySelector("#lotsTable tbody");
  const itemTable = document.querySelector("#item_table tbody");
  const size = document.getElementById("size").value;
  const soItem = document.getElementById("solineitem").value;
  const planKey = document.getElementById("InspectionPlanKey").value;

  const selectedAcceptArray = planKey === "USA" ? acceptarrayUSA : acceptarray;
  const isUSA = planKey === "USA";

  const AQLSelections = {
    holes: document.getElementById("AQL_holes").value,
    NFG: document.getElementById("AQL_NFG").value,
    NAG: document.getElementById("AQL_NAG").value,
    Major: document.getElementById("AQL_Major").value,
    Minor: document.getElementById("AQL_Minor").value,
    GG: document.getElementById("AQL_GG").value,
  };

  itemTable.innerHTML = "";
  let palletCounter = 1;

  for (const row of lotsTable.rows) {
    const cells = row.cells;
    const lot = parseInt(cells[0].textContent.trim());
    const totalPallet = parseInt(cells[1].textContent.trim());
    const totalSample = parseInt(cells[4].textContent.trim());

    const baseSample = Math.floor(totalSample / totalPallet);
    const remainder = totalSample % totalPallet;
    const sampleDistribution = Array.from({ length: totalPallet }, (_, i) =>
      i < remainder ? baseSample + 1 : baseSample
    );

    // --- Acceptance table distribution (common for both) ---
    const acceptKey = selectedAcceptArray.find((x) => parseInt(x.Key) === totalSample);
    const distributeAccept = (value) => {
      if (!value || value === "N/A") return Array(totalPallet).fill(0);
      const num = acceptKey && acceptKey[value] !== undefined ? acceptKey[value] : 0;
      const base = Math.floor(num / totalPallet);
      const rem = num % totalPallet;
      return Array.from({ length: totalPallet }, (_, i) =>
        i < rem ? base + 1 : base
      );
    };

    const accDistributions = {
      holes: distributeAccept(AQLSelections.holes),
      NFG: distributeAccept(AQLSelections.NFG),
      NAG: distributeAccept(AQLSelections.NAG),
      Major: distributeAccept(AQLSelections.Major),
      Minor: distributeAccept(AQLSelections.Minor),
      GG: distributeAccept(AQLSelections.GG),
    };

    // --- USA special case path ---
    if (isUSA) {
      const usaId = `usa_${totalSample}_${totalPallet}`;
      const usaDef = usasamplingtable.find(u => u.id === usaId);

      if (usaDef) {
        usaDef.sample.forEach((s, idx) => {
          for (let i = 0; i < s.times; i++) {
            const palletIndex = idx + i;
            const cols = [
              size, soItem, lot, palletCounter++,
              s.A, s.B, s.C, s.D, s.E, s.F,
              s.sample, s.sample,
              accDistributions.holes[palletIndex] ?? 0,
              accDistributions.NFG[palletIndex] ?? 0,
              accDistributions.NAG[palletIndex] ?? 0,
              accDistributions.Major[palletIndex] ?? 0,
              accDistributions.Minor[palletIndex] ?? 0,
              accDistributions.GG[palletIndex] ?? 0,
            ];

            const tr = document.createElement("tr");
            cols.forEach((v) => {
              const td = document.createElement("td");
              td.textContent = v;
               td.contentEditable =true ;
              tr.appendChild(td);
            });
            itemTable.appendChild(tr);
          }
        });
        continue;
      }
    }

    // --- Non-USA calculation path ---
    const pallets = sampleDistribution.map((sample) => {
      let A, B, C, D, E, F;
      if (sample % 2 === 0) {
        A = 2; B = 1; C = sample / (A * B);
        D = 0; E = 0; F = 0;
      } else {
        A = 1; B = 1; C = Math.floor(sample / 2);
        D = 1; E = 1; F = Math.ceil(sample / 2);
      }
      return { A, B, C, D, E, F, sample };
    });

    // Special fixed non-USA case
    if (totalPallet === 2 && totalSample === 200) {
      pallets[0] = { A: 2, B: 1, C: 33, D: 1, E: 1, F: 34, sample: 100 };
      pallets[1] = { A: 2, B: 1, C: 50, D: 0, E: 0, F: 0, sample: 100 };
    }

    pallets.forEach((p, i) => {
      const cols = [
        size, soItem, lot, palletCounter++,
        p.A, p.B, p.C, p.D, p.E, p.F,
        p.sample, p.sample,
        accDistributions.holes[i],
        accDistributions.NFG[i],
        accDistributions.NAG[i],
        accDistributions.Major[i],
        accDistributions.Minor[i],
        accDistributions.GG[i],
      ];

      const tr = document.createElement("tr");
      cols.forEach((val) => {
        const td = document.createElement("td");
        td.textContent = val;
          td.contentEditable =true ;
        tr.appendChild(td);
      });
      itemTable.appendChild(tr);
    });
  }
}

;

 changemaxpcs()




